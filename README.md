# gismap

Leaflet を使用した地図表示サイト

## 機能

- **ベースマップの切り替え**

  - OpenStreetMap (OSM)
  - 国土地理院地図

- **ハザードマップオーバーレイ**

  - 津波ハザードマップ
  - 土石流警戒区域
  - 急傾斜地警戒区域
  - 地すべり警戒区域
  - 各レイヤーの表示/非表示の切り替え
  - 透過率（opacity）の調整（0-100%）

- **KML レイヤー表示**

  - `kml/`ディレクトリ内の KML ファイルを読み込んで地図上に表示
  - 各 KML ファイルを個別に表示/非表示の切り替えが可能
  - KML マーカーにポップアップ表示（名前・説明）
  - **各 KML レイヤーごとに異なる色のマーカーアイコンを自動適用**
    - 8 色のカラーパレット（赤、青、緑、オレンジ、紫、ティール、ダークオレンジ、グレー）
    - レイヤー一覧に色インジケーターを表示し、どの色が割り当てられているか一目で確認可能

- **初期表示位置**: 函館市

## 使用方法

1. ブラウザで `index.html` を開く
2. 右上のコントロールパネルから以下の操作が可能：
   - ベースマップの選択（OSM または国土地理院）
   - 各種ハザードマップの表示/非表示
     - 津波ハザードマップ
     - 土石流警戒区域
     - 急傾斜地警戒区域
     - 地すべり警戒区域
   - KML レイヤーの個別表示/非表示
   - オーバーレイの透過率調整

### KML ファイルの追加方法

1. `kml/`ディレクトリに KML ファイルを配置
2. `index.html`の`kmlFiles`配列に新しいファイルパスを追加:
   ```javascript
   const kmlFiles = [
     "kml/baseAir.kml",
     "kml/baseGround.kml",
     // ...既存のファイル
     "kml/your-file.kml", // 新しいファイルを追加
   ];
   ```
3. ブラウザで再読み込みすると自動的に読み込まれ、個別のチェックボックスで制御できます

## データソース

- OpenStreetMap: https://www.openstreetmap.org/
- 国土地理院地図: https://maps.gsi.go.jp/
- 津波ハザードマップ: https://disaportaldata.gsi.go.jp/

## 技術スタック

- Leaflet 1.9.4
- Leaflet-omnivore 0.3.4 (KML/GPX/CSV/GeoJSON パーサー)
- HTML5/CSS3/JavaScript

## 動作確認 (ローカル)

1. 単にファイルをダブルクリックで開くと一部ブラウザでローカルファイルの読み込み制限により KML が読み込めない場合があります。以下のように簡易 HTTP サーバを使ってください。

   - Python 3 が使える場合（推奨）:

     ```bash
     # カレントディレクトリを /home/atsu/gismap に移動してから実行
     python3 -m http.server 8000
     ```

     ブラウザで http://localhost:8000 を開く

   - Node.js がある場合:

     ```bash
     npx http-server -c-1
     ```

2. コントロールパネルの「KML レイヤー」項目に各ファイルが表示され、チェックボックスをオンにすると地図上にマーカーが表示されます。

3. 各 KML ファイルに割り当てられた Material Icon と色は、ファイル読み込み時に自動で適用されます。アイコンが表示されない場合は、ブラウザのコンソールを開いてエラーを確認してください。

4. 変更を加えた場合はブラウザのキャッシュをクリアして再読み込みしてください（Shift+Reload が便利です）。

5. さらにアイコン名のマッピングを追加・変更したい場合は、`index.html` 内の `iconNameMap` オブジェクトを編集してください。
